<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd"> 	
	
	

<sqlMap namespace = "user">

	<!-- 로그인시 아이디 비밀번호가 테이블에 존재하는지 여부 -->
	
	<select id="loginCheckSelect" parameterClass="String" resultClass="int"  >
		select count(*)
		from member3 
		where id = #id#
	</select>
	
	
	<!-- 로그인시 마지막 로그인일자를 매번 sysdate update 필요 , 장기미사용자구별목적 -->
	
	<update id="loginDateUpdate" parameterClass="userVo">
		update member3 set lastlogin = sysdate where id = #id# and pass = #pass#
	</update>
	
	<!-- 로그인시 일반/요리사/관리자인지 구별 -->
	
	<select id="loginGradeCodeSelect" parameterClass="userVo" >
		SELECT gradecode(회원구분코드) 
		FROM member3
		WHERE id = #id# and pass = #pass#
	</select>
	
	
	<!-- 회원가입 정보 등록 -일반회원과 메니저 모두 사용 ( 아래아래 charge테이블 insert 반드시 같이 코딩 해주세요) -->
	
	<insert id="joinInsertA" parameterClass="userVo" >
		INSERT INTO member3 VALUES ( #ID#, #NAME#, #PASS#, #EMAIL#, #PHONE#, 
									#GRADECODE# , 0 , sysdate , #ZIP# , #ADDR1# , #ADDR2# , NULL )
	</insert>
	
	<!--  회원가입 정보 등록 - 요리사  ( 아래 charge테이블 insert 반드시 같이 코딩 해주세요)-->
		
	<insert id="joinInsertC" parameterClass="userVo">
		INSERT INTO member3 VALUES ( #ID#, #NAME#, #PASS#, #EMAIL#, #PHONE#, 
									'c' , 0 , sysdate , #ZIP# , #ADDR1# , #ADDR2# , #WORK_COD# )
	</insert>
	
	
	
	<!-- 위에 회원가입 정보 등록 insert 실행시  반드시 charge테이블에 각각 회원의 포인트를 0 으로 셋팅 필요 -->
	
	<insert id="joinChargeInsert" parameterClass="String" >
		INSERT INTO charge values ( #id# , '0', sysdate)
	</insert>
	
	
	<!-- 아이디 찾기 - 이메일값필요 -->
	<select id="findIdSelectE" parameterClass="String" >
		SELECT id
		FROM member3
		WHERE email = #email#
	</select>
		
	<!-- 아이디 찾기 - 전화번호값필요 -->
	<select id="findIdSelectT" parameterClass="String" >
		SELECT id
		FROM member3
		WHERE phone = #phone#
	</select>
	
	
	<!-- 아이디 찾기 - 이메일과/전화번호값필요 -->
	<select id="findIdSelectET" parameterClass="userVo" >
		SELECT id
		FROM member3
		WHERE phone = #phone# 
		AND email = #email#
	</select>

	
	<!-- 비밀번호 찾기 이메일/아이디값필요 -->
	<select id="findPass" parameterClass="userVo" >
		SELECT pass
		FROM member3
		WHERE  email = #email#
		AND id = #id#
	</select>
	
	
	<!-- 회원 1명의 정보 조회 아이디값필요 -->
	<select id="viewOneMemSelect" parameterClass="String" >
        SELECT  name, email, phone ,  
				DECODE (gradecode , 'a' , '일반회원' , 'c' , '요리사' , 'm' , '관리자') "회원구분" , 
				point , lastlogin  , zip || addr1 || addr2 "주소" , work_cod
		FROM member3
        WHERE id = #id#
	
	</select>
	
	
	<!-- 구매횟수에 따른 회원분류 ( 다이아몬드/사파이어/골드/실버/일반) 아이디값필요  -->
	<select id="memberGradeSelect" parameterClass="String" >
			SELECT ( CASE WHEN COUNT(order_cod) >= '200' THEN '다이아몬드' 
                     	  WHEN COUNT(order_cod) >= '150' THEN '사파이어'
					      WHEN COUNT(order_cod) >= '100' THEN '골드'
                          WHEN COUNT(order_cod) >= '50' THEN '실버'
                          WHEN COUNT(order_cod) >= '0' THEN '일반'
                     ELSE 'VVIP' 
                     END ) grade 
			FROM order3
			WHERE order_status = 'd' AND id = #id#
			GROUP BY id
	
	
	
	
	</select>

	


</sqlMap>